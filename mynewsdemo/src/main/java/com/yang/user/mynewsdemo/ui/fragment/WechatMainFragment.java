package com.yang.user.mynewsdemo.ui.fragment;import android.graphics.Color;import android.os.Bundle;import android.support.annotation.Nullable;import android.support.v4.app.Fragment;import android.support.v7.widget.DefaultItemAnimator;import android.support.v7.widget.LinearLayoutManager;import android.support.v7.widget.OrientationHelper;import android.support.v7.widget.RecyclerView;import android.util.Log;import android.view.LayoutInflater;import android.view.View;import android.view.ViewGroup;import com.google.gson.Gson;import com.google.gson.GsonBuilder;import com.yang.user.mynewsdemo.R;import com.yang.user.mynewsdemo.app.Constants;import com.yang.user.mynewsdemo.ui.adapter.WechatMainAdapter;import com.yang.user.mynewsdemo.ui.api.WeChatApis;import com.yang.user.mynewsdemo.ui.bean.WXItemBean;import com.yang.user.mynewsdemo.ui.view.basepullrefresh.MyBaseSwipeRefreshLayout;import java.util.ArrayList;import java.util.List;import butterknife.BindView;import butterknife.ButterKnife;import retrofit2.Call;import retrofit2.Callback;import retrofit2.Response;import retrofit2.Retrofit;import retrofit2.converter.gson.GsonConverterFactory;/** * Created by User on 2017/3/9. */public class WechatMainFragment extends Fragment{    @BindView(R.id.rv_content)    RecyclerView rvWechatList;    @BindView(R.id.swipe_refresh)    MyBaseSwipeRefreshLayout myBaseSwipeRefreshLayout;    private View view;    private int currentpage = 1;/*当前页数*/    private int totalPagerNumber = 10;/*总页数*/    private static final int pagerNumberContent = 2;    List<WXItemBean.NewslistBean> mList = new ArrayList<>();    private WechatMainAdapter adapter;    @Nullable    @Override    public View onCreateView(LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {        view = LayoutInflater.from(getActivity()).inflate(R.layout.fragment_wechat, container, false);        ButterKnife.bind(this, view);        initView();        initData();        loadUpData();        return view;    }    private void initView() {        LinearLayoutManager layoutManager = new LinearLayoutManager(getActivity());        rvWechatList.setLayoutManager(layoutManager);        layoutManager.setOrientation(OrientationHelper.VERTICAL);        rvWechatList.setItemAnimator(new DefaultItemAnimator());    }    private void initData() {        final Gson gson = new GsonBuilder().create();        Retrofit retrofit = new Retrofit.Builder().baseUrl(WeChatApis.HOST).addConverterFactory(GsonConverterFactory.create(gson)).build();        WeChatApis wechatApi = retrofit.create(WeChatApis.class);        Call<WXItemBean> wxitembean = wechatApi.getWXHot(Constants.KEY_API, pagerNumberContent, currentpage);        wxitembean.enqueue(new Callback<WXItemBean>() {            @Override            public void onResponse(Call<WXItemBean> call, Response<WXItemBean> response) {                mList.addAll(response.body().getNewslist());                Log.e("yangjie", "" + mList.get(1).getCtime());                adapter = new WechatMainAdapter(getActivity(), mList);                rvWechatList.setAdapter(adapter);                adapter.notifyDataSetChanged();//                adapter.setOnItemClickListener(new WechatMainAdapter.OnItemClickListener() {//                    @Override//                    public void onItemClick(int position, View view) {//                        Intent intent = new Intent();//                        intent.setClass(getActivity(), AndroidWebViewActivity.class);//                        intent.putExtra("gank_girlitem_data", mList.get(position).getUrl());//                        ActivityOptions options = ActivityOptions.makeSceneTransitionAnimation(getActivity(), view, "webview");//                        getActivity().startActivity(intent, options.toBundle());//                    }//                });            }            @Override            public void onFailure(Call<WXItemBean> call, Throwable t) {                Log.e("", "");            }        });    }    private void loadUpData() {        myBaseSwipeRefreshLayout.setColorSchemeColors(Color.RED,Color.GREEN,Color.BLUE);        myBaseSwipeRefreshLayout.setOnRefreshListener(new MyBaseSwipeRefreshLayout.OnRefreshListener() {            @Override            public void onRefresh() {                if(currentpage >= totalPagerNumber){                    myBaseSwipeRefreshLayout.setRefreshing(false);                    adapter.notifyDataSetChanged();                }else{                    currentpage++;                    initData();                    adapter.notifyDataSetChanged();                    myBaseSwipeRefreshLayout.setRefreshing(false);                }            }        });        myBaseSwipeRefreshLayout.setBottomColorSchemeColors(Color.GREEN,Color.BLUE,Color.YELLOW,Color.RED);        myBaseSwipeRefreshLayout.setOnBottomRefreshListenrer(new MyBaseSwipeRefreshLayout.OnBottomRefreshListener() {            @Override            public void onBottomRefresh() {                if(currentpage >= totalPagerNumber){                    myBaseSwipeRefreshLayout.setBottomRefreshing(false);                    adapter.notifyDataSetChanged();                }else{                    currentpage++;                    initData();                    adapter.notifyDataSetChanged();                    myBaseSwipeRefreshLayout.setBottomRefreshing(false);                }            }        });    }}